<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Portfolio â€” Cube with Panel Bites</title>
<style>
  :root{
    --bg:#071425;
    --panel:rgba(255,255,255,0.03);
    --border:rgba(255,255,255,0.08);
    --text:#e6eef6;
    --muted:rgba(190,215,240,0.7);
    --gap:2vw;
    --cube-size:260px;
    --bite-radius:150px;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .container{width:100vw;height:100vh;position:relative;overflow:hidden}

  /* Left column: title + description stacked, aligned with image */
  .title {
    position:absolute;
    left:2vw;
    top:2vh;
    width:calc(46vw - var(--gap));
    height:36vh;
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:16px;
    padding:24px;
    box-shadow:0 8px 32px rgba(0,0,0,0.3);
    overflow:visible;
  }
  .title h1{font-size:32px;margin-bottom:8px}
  .title p{color:var(--muted)}

  .description {
    position:absolute;
    left:2vw;
    top:calc(2vh + 36vh + var(--gap));
    width:calc(46vw - var(--gap));
    height:calc(82vh - 36vh - var(--gap) - 2vh);
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:16px;
    padding:24px;
    box-shadow:0 8px 32px rgba(0,0,0,0.3);
    overflow:visible;
  }
  .description p{color:var(--muted);line-height:1.5}

  /* Right: image */
  .img {
    position:absolute;
    right:2vw;
    top:2vh;
    width:50vw;
    height:80vh;
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:16px;
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    color:var(--muted);
    box-shadow:0 8px 32px rgba(0,0,0,0.3);
    overflow:visible;
  }

  /* Panels bite pseudo-element (circle) - hidden by default; JS sets vars */
  .title::after, .description::after, .img::after{
    content:'';
    position:absolute;
    width:calc(var(--bite-radius) * 2);
    height:calc(var(--bite-radius) * 2);
    left:var(--bite-x,-9999px);
    top:var(--bite-y,-9999px);
    transform:translate(-50%,-50%);
    border-radius:50%;
    background:var(--bg);
    pointer-events:none;
    opacity:var(--bite-visible,0);
    transition:left .12s linear, top .12s linear, opacity .18s linear;
    z-index:5;
  }

  /* Center cube */
  .cube-container{
    position:absolute;
    left:50%;
    top:42%;
    transform:translate(-50%,-50%);
    z-index:6;
    pointer-events:none;
  }
  .scene{
    width:var(--cube-size);
    height:var(--cube-size);
    perspective:1000px;
    pointer-events:auto;
    user-select:none;
    touch-action:none;
    position:relative;
  }
  .rod{
    position:absolute;
    left:50%;top:50%;
    width:4px;height:420px;
    transform:translate(-50%,-50%);
    background:linear-gradient(180deg, transparent, rgba(255,255,255,0.08) 20%, rgba(255,255,255,0.08) 80%, transparent);
    pointer-events:none; z-index:4;
  }
  .cube{
    width:100%;height:100%;position:relative;transform-style:preserve-3d;
    transform:translateZ(-120px) rotateX(-8deg) rotateY(0deg);transition:transform .08s linear;
    z-index:7;
  }
  .face{
    position:absolute;left:0;top:0;width:100%;height:100%;
    border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border:1px solid var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;
    backface-visibility:hidden;box-shadow:0 10px 36px rgba(0,0,0,0.6);cursor:pointer;
  }
  .face h3{margin:0 0 6px 0;font-size:20px}
  .front{transform:rotateY(0deg) translateZ(calc(var(--cube-size)/2))}
  .right{transform:rotateY(90deg) translateZ(calc(var(--cube-size)/2))}
  .back{transform:rotateY(180deg) translateZ(calc(var(--cube-size)/2))}
  .left{transform:rotateY(-90deg) translateZ(calc(var(--cube-size)/2))}

  /* Projects row (wrapping) */
  .projects{
    position:absolute;left:0;right:0;bottom:0;
    min-height:16vh;padding:2vh 2vw;display:flex;flex-wrap:wrap;gap:14px;align-items:center;justify-content:center;
    background:linear-gradient(to top, rgba(0,0,0,0.4), transparent);
    z-index:8;
  }
  .project-btn{
    width:140px;height:84px;background:var(--panel);border:1px solid var(--border);border-radius:10px;
    display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;font-size:18px;
    transition:transform .18s,box-shadow .18s;
  }
  .project-btn:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(0,0,0,0.45)}
  .project-btn:first-child{background:rgba(255,255,255,0.06)}

  /* small helpers */
  @media (max-width:980px){
    :root{--cube-size:220px;--bite-radius:120px}
    .title,.description{width:calc(100% - 4vw);left:2vw;top:auto}
    .title{top:2vh;height:20vh}
    .description{top:calc(2vh + 20vh + var(--gap));height:26vh}
    .img{position:relative;left:2vw;right:2vw;top:auto;width:calc(100% - 4vw);height:32vh;margin-top:calc(2vh + 20vh + 26vh + var(--gap))}
    .cube-container{position:relative;left:50%;top:0;transform:translate(-50%,0);margin-top:12px}
    .projects{position:relative}
  }
</style>
</head>
<body>
  <div class="container">
    <div class="title" id="titlePanel">
      <h1 id="projTitle">Minesweeper</h1>
      <p id="projSubtitle">Interactive tile-based puzzle</p>
    </div>

    <div class="description" id="descPanel">
      <p id="projDesc">Classic minesweeper rebuilt with modern UI. Click or drag the cube; title/description/image update to the most-visible face. The cube will carve a circular bite into these panels when overlapping.</p>
    </div>

    <div class="img" id="imagePanel">Minesweeper preview (no image)</div>

    <div class="cube-container">
      <div class="scene" id="scene" aria-label="3D cube scene">
        <div class="rod" aria-hidden="true"></div>
        <div class="cube" id="cube" role="application">
          <div class="face front" data-slot="front"><h3>Project 1</h3><p>Interactive tile puzzle</p></div>
          <div class="face right" data-slot="right"><h3>Project 2</h3><p>Utility tool</p></div>
          <div class="face back" data-slot="back"><h3>Project 3</h3><p>Algorithmic art</p></div>
          <div class="face left" data-slot="left"><h3>Project 4</h3><p>UX experiments</p></div>
        </div>
      </div>
    </div>

    <div class="projects" id="projectsBar"></div>
  </div>

<script>
/* Data */
const projects = [
  {title:'Minesweeper', subtitle:'Interactive tile-based puzzle', desc:'Classic minesweeper rebuilt with modern UI', url:'#', color:'#e74c3c'},
  {title:'Project 2', subtitle:'Utility tool', desc:'Small utility demo', url:'#', color:'#27ae60'},
  {title:'Project 3', subtitle:'Algorithmic art', desc:'Generative visuals', url:'#', color:'#9b59b6'},
  {title:'Project 4', subtitle:'UX experiments', desc:'Micro interactions', url:'#', color:'#1abc9c'},
  {title:'Project 5', subtitle:'Extra', desc:'Extra project', url:'#', color:'#f39c12'},
  {title:'Project 6', subtitle:'Extra 2', desc:'Extra project 2', url:'#', color:'#34495e'}
];

/* Build projects bar (wrapping) */
const projectsBar = document.getElementById('projectsBar');
function renderProjects(){
  projectsBar.innerHTML = '';
  projects.forEach((p,i)=>{
    const el = document.createElement('div');
    el.className = 'project-btn';
    el.innerHTML = `<strong>${i+1}</strong><div style="font-size:12px;color:var(--muted);margin-top:6px">${p.title}</div>`;
    el.addEventListener('click', ()=> centerCubeOnProject(i));
    projectsBar.appendChild(el);
  });
}
renderProjects();

/* Cube rotation state (drag to rotate) */
const scene = document.getElementById('scene');
const cube = document.getElementById('cube');
let rotY = 0, isDown=false, startX=0, startRot=0, startT=0, angVel=0;
const SENS = 0.35, CLICK_MOVE_THRESHOLD=6, CLICK_TIME_THRESHOLD=300;

scene.addEventListener('pointerdown', e=>{
  isDown = true; startX = e.clientX; startRot = rotY; startT = performance.now(); angVel = 0;
  scene.setPointerCapture(e.pointerId);
});
scene.addEventListener('pointermove', e=>{
  if(!isDown) return;
  const dx = e.clientX - startX; const target = startRot + dx * SENS;
  angVel = target - rotY; rotY = target; applyRotation();
});
scene.addEventListener('pointerup', e=>{
  try{ scene.releasePointerCapture(e.pointerId); }catch{}
  const dt = performance.now() - startT; const moved = Math.hypot(e.clientX - startX, e.clientY - startX);
  const isClick = moved <= CLICK_MOVE_THRESHOLD && dt <= CLICK_TIME_THRESHOLD;
  isDown = false; angVel = Math.max(-20, Math.min(20, angVel));
  if(isClick){
    const el = document.elementFromPoint(e.clientX, e.clientY);
    const face = el && el.closest && el.closest('.face');
    if(face){ openFaceProject(face); }
  }
});

/* Apply rotation transform and update UI */
function applyRotation(){
  cube.style.transform = `translateZ(-120px) rotateX(-8deg) rotateY(${rotY}deg)`;
  updateMostVisibleFace();
  updatePanelBites();
}

/* Visibility heuristic: choose most visible horizontal face (angle-based) */
function updateMostVisibleFace(){
  // slotAngles mapping front=0, right=-90, back=180, left=90
  const rad = rotY * Math.PI / 180;
  const slotAngles = [0, -Math.PI/2, Math.PI, Math.PI/2];
  const scores = slotAngles.map(sa=>{
    const diff = normalizeAngleRad(-rad - sa);
    return Math.max(0, Math.cos(diff));
  });
  let best = -1, bestIdx = 0;
  scores.forEach((s,i)=>{ if(s>best){ best=s; bestIdx=i }});
  const slotNames = ['front','right','back','left'];
  const projectIndex = bestIdx % projects.length;
  const p = projects[projectIndex];
  if(p){
    document.getElementById('projTitle').textContent = p.title;
    document.getElementById('projSubtitle').textContent = p.subtitle;
    document.getElementById('projDesc').textContent = p.desc;
    document.getElementById('imagePanel').textContent = `${p.title} preview (no image)`;
    document.getElementById('imagePanel').style.borderLeft = `4px solid ${p.color}`;
  }
}
function normalizeAngleRad(a){
  const two = Math.PI*2; let v = (a + Math.PI) % two; if(v < 0) v += two; return v - Math.PI;
}

/* Panel bite calculation:
   Compute cube footprint center (scene center) in page coords and footprint radius.
   For each panel, find closest point on panel rect to footprint center; if inside radius + margin, set CSS vars to place bite pseudo-element.
*/
const titlePanel = document.getElementById('titlePanel');
const descPanel = document.getElementById('descPanel');
const imagePanel = document.getElementById('imagePanel');

function getFootprint(){
  const rect = scene.getBoundingClientRect();
  return { x: rect.left + rect.width/2, y: rect.top + rect.height/2, radius: (parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--bite-radius')) || 150) };
}

function updatePanelBite(panelEl){
  const rect = panelEl.getBoundingClientRect();
  const fp = getFootprint();
  const closestX = Math.max(rect.left, Math.min(fp.x, rect.right));
  const closestY = Math.max(rect.top, Math.min(fp.y, rect.bottom));
  const dx = closestX - fp.x, dy = closestY - fp.y;
  const dist = Math.hypot(dx,dy);
  const margin = 6;
  if(dist < fp.radius + margin){
    const localX = Math.round(closestX - rect.left);
    const localY = Math.round(closestY - rect.top);
    panelEl.style.setProperty('--bite-x', `${localX}px`);
    panelEl.style.setProperty('--bite-y', `${localY}px`);
    panelEl.style.setProperty('--bite-visible', '1');
  } else {
    panelEl.style.setProperty('--bite-visible', '0');
    panelEl.style.setProperty('--bite-x', `-9999px`);
    panelEl.style.setProperty('--bite-y', `-9999px`);
  }
}
function updatePanelBites(){
  updatePanelBite(titlePanel); updatePanelBite(descPanel); updatePanelBite(imagePanel);
}

/* Center cube on project (simple mapping: projIdx % 4 => slot) */
function centerCubeOnProject(projIdx){
  const slot = projIdx % 4; // 0 front,1 right,2 back,3 left
  const desiredRel = -slot * 90;
  animateRotationTo(rotY + desiredRel, 420);
}
function animateRotationTo(targetDeg, duration=420){
  const start = performance.now(), from = rotY;
  function step(ts){
    const t = Math.min(1, (ts - start)/duration);
    const eased = 1 - Math.pow(1-t,3);
    rotY = from + (targetDeg - from) * eased;
    applyRotation();
    if(t < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* Click handler for face -> open mapped project */
function openFaceProject(faceEl){
  const slot = faceEl.dataset.slot;
  const mapping = {front:0,right:1,back:2,left:3};
  const idx = mapping[slot] % projects.length;
  const p = projects[idx];
  if(p && p.url) window.open(p.url,'_blank');
}

/* Inertia loop */
let last = performance.now();
function loop(now){
  const dt = (now - last)/1000; last = now;
  if(!isDown && Math.abs(angVel) > 0.0005){
    rotY += angVel;
    angVel *= Math.pow(0.90, dt*60);
    applyRotation();
  }
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* Recompute on resize/load */
window.addEventListener('resize', ()=>{ updatePanelBites(); applyRotation(); });
window.addEventListener('load', ()=>{ updatePanelBites(); applyRotation(); setTimeout(()=>{ updatePanelBites() },120) });

/* Face click binding (open project) */
Array.from(document.querySelectorAll('.face')).forEach(f=>{
  f.addEventListener('click', ()=> openFaceProject(f));
});

/* Initial render */
applyRotation();
updatePanelBites();
</script>
</body>
</html>
