<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JackFShields — Cube Illusion (Fixed)</title>
<style>
  :root{
    --bg:#071425;
    --panel-grad: linear-gradient(180deg, rgba(255,255,255,0.035), rgba(255,255,255,0.01));
    --border: rgba(255,255,255,0.08);
    --text:#e6eef6;
    --muted: rgba(190,215,240,0.7);
    --gap:20px;
    --stage-size:360px;
  }

  html,body{height:100%;margin:0;background:radial-gradient(circle at 18% 16%, #00121a 0%, var(--bg) 30%, #000814 100%);color:var(--text);font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:48px;box-sizing:border-box;gap:24px;}

  /* Bento grid container (preserve your layout) */
  .bento {
    width: min(1100px, 96%);
    display:grid;
    grid-template-columns: 1fr min(var(--stage-size), 36vw) 1fr;
    grid-template-rows: auto min(var(--stage-size), 36vw) auto;
    gap: var(--gap);
    align-items:start;
  }

  .panel {
    background: var(--panel-grad);
    border:1px solid var(--border);
    border-radius:12px;
    padding:18px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
  }
  .panel .title { margin:0 0 8px 0; font-weight:700; font-size:1.1rem; color:var(--text); }
  .panel .body { margin:0; color:var(--muted); font-size:0.95rem; }

  .left-col { grid-column:1 / 2; grid-row:1 / 3; display:flex; flex-direction:column; gap:var(--gap); }
  .right-col { grid-column:3 / 4; grid-row:1 / 3; display:flex; flex-direction:column; gap:var(--gap); }

  .stage-cell { grid-column:2 / 3; grid-row:2 / 3; display:flex; align-items:center; justify-content:center; position:relative; }

  .stage {
    width:var(--stage-size);
    height:var(--stage-size);
    position:relative;
    perspective:900px;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .illusion {
    width:100%;
    height:100%;
    position:relative;
    overflow:visible;
  }

  .face-panel {
    position:absolute;
    top:50%;
    left:50%;
    width:70%;
    height:70%;
    transform-origin:center center;
    display:flex;
    align-items:flex-end;
    justify-content:flex-start;
    padding:16px;
    box-sizing:border-box;
    border-radius:12px;
    background: var(--panel-grad);
    border:1px solid var(--border);
    box-shadow: 0 18px 40px rgba(0,0,0,0.55);
    transition: transform 380ms cubic-bezier(.2,.9,.2,1), opacity 200ms ease, filter 200ms ease;
    cursor:pointer;
    user-select:none;
  }

  .face-panel .meta { background:linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.28)); padding:10px; border-radius:8px; width:100%; }
  .face-panel h3 { margin:0 0 6px 0; font-size:1.05rem; color:var(--text); }
  .face-panel p { margin:0; color:var(--muted); font-size:0.9rem; }

  .face-panel .accent { position:absolute; right:12px; top:12px; width:12px; height:12px; border-radius:4px; }

  /* DOM order in markup: face-0 (center), face-1 (right), face-2 (far-right), face-3 (left), face-4 (far-left) */
  .face-0 { transform: translate(-50%,-50%) translateX(0) scale(1) skewY(0deg); z-index:30; opacity:1; }
  .face-1 { transform: translate(-50%,-50%) translateX(48%) scale(0.84) skewY(-12deg); z-index:20; opacity:0.98; }
  .face-2 { transform: translate(-50%,-50%) translateX(96%) scale(0.68) skewY(-18deg); z-index:10; opacity:0.86; pointer-events:none; }
  .face-3 { transform: translate(-50%,-50%) translateX(-48%) scale(0.84) skewY(12deg); z-index:20; opacity:0.98; }
  .face-4 { transform: translate(-50%,-50%) translateX(-96%) scale(0.68) skewY(18deg); z-index:10; opacity:0.86; pointer-events:none; }

  .top-plate {
    position:absolute;
    width:58%;
    height:20%;
    left:50%;
    top:18%;
    transform-origin:center center;
    transform: translateX(-50%) translateY(-50%) rotateX(60deg);
    border-radius:8px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
    border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 12px 30px rgba(0,0,0,0.6) inset;
    transition: transform 380ms cubic-bezier(.2,.9,.2,1), opacity 380ms ease;
    pointer-events:none;
    opacity:0.8;
  }

  .controls { grid-column:1 / 4; grid-row:3 / 4; display:flex; align-items:center; justify-content:center; gap:12px; margin-top:8px; }
  .projects-list { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; max-width:1100px; }
  .project-btn { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); padding:8px 12px; border-radius:8px; cursor:pointer; font-size:0.92rem; }
  .project-btn.active { border-color:rgba(255,255,255,0.18); color:var(--text); background:rgba(255,255,255,0.02); }

  .hint { grid-column:1 / 4; text-align:center; color:var(--muted); font-size:0.88rem; margin-top:6px; }

  @media (max-width:980px) {
    .bento { grid-template-columns: 1fr; grid-template-rows: auto auto auto; }
    .left-col, .right-col { grid-column:1; grid-row:auto; order:2; }
    .stage-cell { grid-column:1; order:1; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="bento" id="bentoRoot">
      <div class="left-col">
        <div class="panel" id="leftPanelTop">
          <div class="title" id="leftTitle">Loading…</div>
          <p class="body" id="leftBody">Loading subtitle…</p>
        </div>
        <div class="panel" id="leftPanelBottom">
          <div class="title" id="leftSmallTitle">Meta</div>
          <p class="body" id="leftSmallBody">Extra info</p>
        </div>
      </div>

      <div class="stage-cell">
        <div class="stage" aria-hidden="false">
          <div class="illusion" id="illusion" aria-live="polite">
            <div class="face-panel face-0" data-slot="0" role="button" tabindex="0">
              <div class="accent" aria-hidden="true"></div>
              <div class="meta">
                <h3 class="title">Loading…</h3>
                <p class="subtitle">Please wait</p>
              </div>
            </div>

            <div class="face-panel face-1" data-slot="1" role="button" tabindex="-1">
              <div class="accent" aria-hidden="true"></div>
              <div class="meta">
                <h3 class="title">Loading…</h3>
                <p class="subtitle">Please wait</p>
              </div>
            </div>

            <div class="face-panel face-2" data-slot="2" role="presentation" aria-hidden="true">
              <div class="accent" aria-hidden="true"></div>
              <div class="meta">
                <h3 class="title">Loading…</h3>
                <p class="subtitle">Please wait</p>
              </div>
            </div>

            <div class="face-panel face-3" data-slot="3" role="button" tabindex="-1">
              <div class="accent" aria-hidden="true"></div>
              <div class="meta">
                <h3 class="title">Loading…</h3>
                <p class="subtitle">Please wait</p>
              </div>
            </div>

            <div class="face-panel face-4" data-slot="4" role="presentation" aria-hidden="true">
              <div class="accent" aria-hidden="true"></div>
              <div class="meta">
                <h3 class="title">Loading…</h3>
                <p class="subtitle">Please wait</p>
              </div>
            </div>
          </div>

          <div class="top-plate" id="topPlate" aria-hidden="true"></div>
        </div>
      </div>

      <div class="right-col">
        <div class="panel" id="rightPanelTop">
          <div class="title" id="rightTitle">Loading…</div>
          <p class="body" id="rightBody">Loading subtitle…</p>
        </div>
        <div class="panel" id="rightPanelBottom">
          <div class="title" id="rightSmallTitle">Links</div>
          <p class="body" id="rightSmallBody">Project links</p>
        </div>
      </div>

      <div class="controls">
        <div class="projects-list" id="projectsList" aria-label="Project shortcuts"></div>
      </div>

      <div class="hint">Click a face to open; use the buttons to jump. This is a 3D illusion (no real 3D transforms).</div>
    </div>
  </div>

<script>
/* ---------- Helpers ---------- */
const mod = (n, m) => ((n % m) + m) % m;
const clamp = (v,a,b) => Math.max(a, Math.min(b, v));

/* ---------- Config / State ---------- */
const TRANSITION_MS = 380;
const projectsJsonPath = '/docs/projects.json'; // per your request
let projects = [];
let frontIndex = 0; // logical index of center project
let isAnimating = false;

/* DOM refs */
const illusion = document.getElementById('illusion');
const slotEls = Array.from(illusion.querySelectorAll('.face-panel')); // order matches markup
const topPlate = document.getElementById('topPlate');
const projectsList = document.getElementById('projectsList');

/* --- Load projects.json (fallback inline) --- */
async function loadProjects() {
  try {
    const res = await fetch(projectsJsonPath);
    if (!res.ok) throw new Error('no json');
    const data = await res.json();
    if (Array.isArray(data) && data.length) projects = data;
    else throw new Error('empty');
  } catch (e) {
    projects = [
      { title: "Minesweeper", subtitle: "Interactive tile-based puzzle", desc: "Classic minesweeper rebuilt", url: "", image: null, color: "#e74c3c" },
      { title: "Poly Weave", subtitle: "Generative geometry experiments", desc: "Woven polygons", url: "", image: null, color: "#9b59b6" },
      { title: "Grid Tools", subtitle: "UI toolkit for responsive grids", desc: "Utilities for layouts", url: "", image: null, color: "#1abc9c" },
      { title: "UX Microinteractions", subtitle: "Interaction experiments", desc: "Playful loaders", url: "", image: null, color: "#f39c12" },
      { title: "Data Viz Playground", subtitle: "Algorithmic visualizations", desc: "Visual encodings", url: "", image: null, color: "#27ae60" },
      { title: "Portfolio Experiments", subtitle: "Design systems and transitions", desc: "Sandbox experiments", url: "", image: null, color: "#34495e" }
    ];
  }

  // preload a few images
  projects.slice(0, 12).forEach(p => { if (p.image) { const i = new Image(); i.src = p.image; }});

  renderProjectButtons();
  renderVisibleSlots();
  wireSlotInteractions();
  populateSidePanels();
}

/* ---------- Render visible slots ---------- */
/* DOM order slots correspond to: [center, right, far-right, left, far-left]
   We map them to logical offsets: [0, +1, +2, -1, -2] relative to frontIndex.
   This uses modular wrapping so you never get negative labels.
*/
function renderVisibleSlots() {
  const N = Math.max(1, projects.length);
  const offsets = [0, 1, 2, -1, -2]; // mapping aligned to slotEls order
  slotEls.forEach((slotEl, i) => {
    const logical = frontIndex + offsets[i];
    const wrapped = mod(logical, N);
    applySlotContent(slotEl, wrapped, logical);
    // accessibility: center and immediate neighbors interactive
    const isInteractive = (offsets[i] === 0 || offsets[i] === 1 || offsets[i] === -1);
    slotEl.tabIndex = isInteractive ? 0 : -1;
    slotEl.setAttribute('role', isInteractive ? 'button' : 'presentation');
  });

  updateTopPlateVisual();
  updateButtonsActiveState();
}

/* ---------- Apply content to slot ---------- */
/* We always wrap to a valid project index to avoid negative labels; if you want placeholders instead,
   change to show placeholder when logical is out of [0..N-1]. */
function applySlotContent(slotEl, wrappedIdx, logicalIdx) {
  const p = projects[wrappedIdx] || {};
  const titleEl = slotEl.querySelector('h3.title');
  const subEl = slotEl.querySelector('p.subtitle');
  const accent = slotEl.querySelector('.accent');
  titleEl.textContent = p.title || `Project ${wrappedIdx + 1}`;
  subEl.textContent = p.subtitle || p.desc || '';
  accent.style.background = p.color || '#888';
  slotEl.style.backgroundImage = p.image ? `url(${p.image})` : '';
  slotEl.dataset.index = wrappedIdx;
}

/* ---------- Top plate visual ---------- */
function updateTopPlateVisual() {
  const offset = (frontIndex % 2 === 0) ? -6 : 6; // tiny shift for subtle motion
  topPlate.style.transform = `translateX(${offset}px) translateY(-50%) rotateX(60deg)`;
}

/* ---------- Navigation / animation ---------- */
function stepTo(delta) {
  if (isAnimating) return;
  isAnimating = true;
  const prev = frontIndex;
  frontIndex = frontIndex + delta;

  // visual nudge: temporarily move the illusion container then reset and re-render
  illusion.style.transition = `transform ${TRANSITION_MS}ms cubic-bezier(.2,.9,.2,1)`;
  const pixelShift = -delta * 38; // visual nudge
  illusion.style.transform = `translateX(${pixelShift}px)`;

  slotEls.forEach((s, idx) => {
    s.style.transition = `transform ${TRANSITION_MS}ms cubic-bezier(.2,.9,.2,1), opacity ${TRANSITION_MS}ms ease`;
    if (Math.abs(idx - 1) > 1) s.style.opacity = '0.7';
  });

  setTimeout(() => {
    illusion.style.transition = '';
    illusion.style.transform = '';
    slotEls.forEach(s => { s.style.transition = ''; s.style.opacity = ''; });
    renderVisibleSlots();
    populateSidePanels();
    isAnimating = false;
  }, TRANSITION_MS + 20);
}

/* Minimal signed jump (wrap-aware) */
function jumpTo(targetIdx) {
  if (isAnimating) return;
  const N = Math.max(1, projects.length);
  // compute minimal signed delta in [-floor(N/2), ceil(N/2)]
  let raw = targetIdx - frontIndex;
  raw = ((raw + Math.floor(N/2) * 1000) % N) - Math.floor(N/2);
  stepTo(raw);
}

/* ---------- Slot interactions ---------- */
function wireSlotInteractions() {
  slotEls.forEach(s => {
    s.addEventListener('click', () => {
      const idx = Number(s.dataset.index);
      if (!Number.isFinite(idx)) return;
      // if clicked center, open; otherwise jump to it
      const centerWrapped = mod(frontIndex, Math.max(1, projects.length));
      if (idx === centerWrapped) openProject(idx);
      else jumpTo(idx);
    });
    s.addEventListener('keydown', (ev) => {
      if (ev.key === 'Enter' || ev.key === ' ') {
        ev.preventDefault();
        s.click();
      }
    });
  });

  // Desktop drag on illusion: pointer capture used on illusion element
  let pointerId = null;
  let startX = null;

  illusion.addEventListener('pointerdown', (e) => {
    if (e.pointerType === 'mouse' && e.button !== 0) return;
    if (isAnimating) return;
    pointerId = e.pointerId;
    startX = e.clientX;
    illusion.setPointerCapture?.(pointerId);
  });

  illusion.addEventListener('pointermove', (e) => {
    if (pointerId === null || e.pointerId !== pointerId) return;
    const dx = e.clientX - startX;
    // threshold to trigger a step
    if (Math.abs(dx) > 36) {
      const steps = dx > 0 ? -1 : 1; // drag right -> show previous
      // consume movement
      startX = e.clientX;
      stepTo(steps);
    }
  });

  illusion.addEventListener('pointerup', (e) => {
    if (pointerId === null || e.pointerId !== pointerId) return;
    try { illusion.releasePointerCapture?.(pointerId); } catch (_) {}
    pointerId = null;
    startX = null;
  });

  illusion.addEventListener('pointercancel', () => { pointerId = null; startX = null; });
}

/* ---------- Open project ---------- */
function openProject(idx) {
  const p = projects[idx];
  if (!p) return;
  if (p.url) window.open(p.url, '_blank');
  else {
    // fallback lightweight modal using alert for now
    alert(`${p.title || 'Project'}\n\n${p.desc || p.subtitle || ''}`);
  }
}

/* ---------- Buttons rendering ---------- */
function renderProjectButtons() {
  projectsList.innerHTML = '';
  projects.forEach((p, i) => {
    const btn = document.createElement('button');
    btn.className = 'project-btn';
    btn.textContent = p.title || `Project ${i+1}`;
    btn.addEventListener('click', () => jumpTo(i));
    projectsList.appendChild(btn);
  });
  updateButtonsActiveState();
}
function updateButtonsActiveState() {
  const active = mod(frontIndex, Math.max(1, projects.length));
  Array.from(projectsList.children).forEach((btn, i) => {
    btn.classList.toggle('active', i === active);
  });
}

/* ---------- Side panels (preserve layout) ---------- */
function populateSidePanels() {
  const leftTitle = document.getElementById('leftTitle');
  const leftBody = document.getElementById('leftBody');
  const leftSmallTitle = document.getElementById('leftSmallTitle');
  const leftSmallBody = document.getElementById('leftSmallBody');

  const rightTitle = document.getElementById('rightTitle');
  const rightBody = document.getElementById('rightBody');
  const rightSmallTitle = document.getElementById('rightSmallTitle');
  const rightSmallBody = document.getElementById('rightSmallBody');

  const center = projects[mod(frontIndex, projects.length)] || {};
  const right = projects[mod(frontIndex + 1, projects.length)] || {};
  const left = projects[mod(frontIndex - 1, projects.length)] || {};

  leftTitle.textContent = left.title || `Project ${mod(frontIndex - 1, projects.length) + 1}`;
  leftBody.textContent = left.subtitle || left.desc || '';
  leftSmallTitle.textContent = 'Preview';
  leftSmallBody.textContent = `Showing nearby: ${center.title || '…'}`;

  rightTitle.textContent = right.title || `Project ${mod(frontIndex + 1, projects.length) + 1}`;
  rightBody.textContent = right.subtitle || right.desc || '';
  rightSmallTitle.textContent = 'Links';
  rightSmallBody.textContent = right.url || '';
}

/* ---------- Init ---------- */
async function init() {
  await loadProjects();
  renderProjectButtons();
  renderVisibleSlots();
  wireSlotInteractions();
  populateSidePanels();
  // keyboard nav
  window.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') stepTo(-1);
    if (e.key === 'ArrowRight') stepTo(1);
  });
}

init();

/* Dev helpers */
window._cube = { stepTo, jumpTo, state: () => ({ frontIndex, total: projects.length }) };
</script>
</body>
</html>
