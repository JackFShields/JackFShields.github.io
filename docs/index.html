<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JackFShields — Claw Machine</title>
<style>
  :root{
    --bg:#081220;
    --glass: rgba(255,255,255,0.03);
    --muted: #9fbfdc;
    --accent: #4cc1ff;
    --card:#0f1720;
    --capsule-width:84px;
    --capsule-gap:16px;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;background:linear-gradient(180deg,#061226 0%, #020612 100%);color:#eaf3ff;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial, sans-serif;overflow:hidden}
  .wrap{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:28px;gap:20px}

  /* Stage */
  .machine {
    width:min(920px, 94vw);
    height:520px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));
    border:1px solid rgba(255,255,255,0.04);
    border-radius:12px;
    position:relative;
    overflow:visible;
    box-shadow: 0 30px 60px rgba(0,0,0,0.6);
    padding:18px;
    display:flex;
    gap:16px;
  }

  /* Left controls / info (preserve bento vibe) */
  .info {
    width:260px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .panel {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.03);
    padding:12px;
    min-height:72px;
  }
  .panel h3{font-size:0.98rem;margin-bottom:6px;color:#eaf3ff}
  .panel p{color:var(--muted);font-size:0.88rem;line-height:1.2}

  /* Claw area */
  .play {
    flex:1;
    position:relative;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:12px;
  }

  /* machine glass border */
  .glass {
    position:absolute;inset:12px;border-radius:8px;
    pointer-events:none;
    box-shadow: inset 0 2px 0 rgba(255,255,255,0.02), 0 30px 50px rgba(0,0,0,0.6);
  }

  /* Claw rail top */
  .rail {
    position:absolute;
    top:28px;
    left:64px;
    right:64px;
    height:6px;
    background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.005));
    border-radius:6px;
    z-index:50;
    box-shadow:0 6px 20px rgba(0,0,0,0.4);
  }

  /* Claw group */
  .claw {
    position:absolute;
    top:6px;
    left:64px;
    width:120px;
    height:120px;
    transform-origin:top center;
    z-index:120;
    pointer-events:none;
  }

  .claw .arm {
    position:absolute;left:50%;transform:translateX(-50%);
    width:6px;height:80px;background:linear-gradient(180deg,#cfdff0,#7eaed8);
    border-radius:4px;box-shadow:0 6px 12px rgba(0,0,0,0.45);
  }

  .claw .hook {
    position:absolute;left:50%;transform:translateX(-50%);top:74px;
    width:64px;height:24px;border-radius:8px;background:linear-gradient(180deg,#e6f6ff,#cfeeff);
    display:flex;align-items:center;justify-content:center;font-weight:700;color:#05202b;
    box-shadow:0 10px 24px rgba(0,0,0,0.45);
  }

  /* chute (drop target) */
  .chute {
    position:absolute;
    right:28px;
    bottom:28px;
    width:180px;
    height:220px;
    background:linear-gradient(180deg,#081623,#02101a);
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.03);
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    z-index:40;
    box-shadow: inset 0 2px 0 rgba(255,255,255,0.02);
  }
  .chute h4{font-size:0.95rem;margin-bottom:4px}
  .bucket {
    width:120px;height:120px;border-radius:10px;background:linear-gradient(180deg,#071827,#07121a);
    border:1px solid rgba(255,255,255,0.025);display:flex;align-items:center;justify-content:center;
  }

  /* prize area at bottom (where capsules sit) */
  .pit {
    position:absolute;
    left:64px;
    right:220px;
    bottom:34px;
    height:120px;
    display:flex;
    align-items:center;
    gap:var(--capsule-gap);
    padding:12px;
    overflow:visible;
    z-index:30;
  }

  .capsule {
    width:var(--capsule-width);
    height:56px;
    border-radius:28px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
    border:1px solid rgba(255,255,255,0.04);
    display:flex;align-items:center;justify-content:center;
    gap:10px;padding:8px;
    box-shadow:0 8px 18px rgba(0,0,0,0.5);
    cursor:pointer;
    transform-origin:center bottom;
    transition: transform 220ms cubic-bezier(.2,.9,.2,1), box-shadow 160ms;
  }
  .capsule:hover { transform: translateY(-6px) scale(1.02); box-shadow: 0 18px 32px rgba(0,0,0,0.6); }

  .capsule .fav {
    width:36px;height:36px;border-radius:8px;background:#ffffff11;display:flex;align-items:center;justify-content:center;overflow:hidden;
  }
  .capsule img { width:100%; height:100%; object-fit:contain; display:block }

  /* modal popup */
  .modal {
    position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(0.98);
    min-width:300px;background:linear-gradient(180deg,#071827,#021017);
    border-radius:12px;border:1px solid rgba(255,255,255,0.04);padding:18px;z-index:999;
    box-shadow:0 40px 90px rgba(0,0,0,0.7);opacity:0;pointer-events:none;transition:opacity 220ms ease, transform 220ms cubic-bezier(.2,.9,.2,1);
  }
  .modal.show { opacity:1; pointer-events:auto; transform:translate(-50%,-50%) scale(1); }
  .modal h3{margin-bottom:8px;color:#eaf3ff}
  .modal p{color:var(--muted);margin-bottom:12px}
  .modal .ok { background:var(--accent); color:#00202a;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700 }

  /* footer controls */
  .controls { display:flex;gap:10px;align-items:center;justify-content:flex-end;margin-top:8px }
  .btn { background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 12px;border-radius:8px;cursor:pointer }
  .btn.primary { background:var(--accent); color:#05202b; border:none; font-weight:700 }
  .legend{font-size:0.9rem;color:var(--muted);margin-top:8px}

  @media (max-width:900px){
    .machine{height:620px;flex-direction:column;align-items:stretch}
    .info{width:auto;display:flex;flex-direction:row;gap:10px;padding:10px}
    .play{order:2}
    .pit{left:20px;right:20px}
    .chute{right:20px;bottom:12px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="machine" id="machine">
      <div class="info" aria-hidden="false">
        <div class="panel">
          <h3 id="leftTitle">Claw Machine</h3>
          <p id="leftBody">Click a capsule to mark a target, then press "Grab" to send the claw. You can also drag the claw rail to position before grabbing.</p>
        </div>
        <div class="panel">
          <h3 id="leftSmallTitle">Prizes</h3>
          <p id="leftSmallBody">Favicons are used as capsule icons. Drop a prize in the chute to see details.</p>
        </div>
      </div>

      <div class="play" id="playArea" aria-live="polite">
        <div class="glass" aria-hidden="true"></div>

        <div class="rail" id="rail"></div>

        <div class="claw" id="claw" aria-hidden="true" style="left:120px">
          <div class="arm" id="clawArm"></div>
          <div class="hook" id="clawHook">▂▂▂</div>
        </div>

        <div class="chute" id="chute" aria-hidden="false">
          <h4>Prize Bin</h4>
          <div class="bucket" id="bucket"></div>
        </div>

        <div class="pit" id="pit" role="list" aria-label="Prize pit"></div>
      </div>
    </div>

    <div style="width:min(920px,94vw);display:flex;justify-content:space-between;align-items:center">
      <div class="legend">Playful demo — no network calls beyond favicons</div>
      <div class="controls">
        <button class="btn" id="resetBtn">Reset</button>
        <button class="btn primary" id="grabBtn">Grab</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modal" role="dialog" aria-modal="true">
    <h3 id="modalTitle">You got…</h3>
    <p id="modalBody">Project details will show here.</p>
    <div style="display:flex;justify-content:flex-end;gap:10px">
      <button class="ok" id="modalOk">Nice!</button>
    </div>
  </div>

<script>
/*
  Claw Machine
  - Capsules are rendered from projects array below.
  - Each capsule shows a favicon image pulled via Google S2 favicons service by domain.
  - User can click a capsule to mark it (target); or just press Grab to attempt to pick the nearest one under the claw.
  - The claw moves horizontally along the rail, then descends, picks the capsule, lifts, moves to chute, and drops.
  - After a drop, a modal displays the "You got X!" message with details.
*/

/* ---------- Projects (replace or load from projects.json if desired) ---------- */
const projects = [
  { title: "Minesweeper", subtitle: "Interactive tile-based puzzle", url: "https://jackfshields.github.io/minesweeper", color: "#e74c3c" },
  { title: "Poly Weave", subtitle: "Generative geometry experiments", url: "https://jackfshields.github.io/polyweave", color: "#9b59b6" },
  { title: "Grid Tools", subtitle: "UI toolkit for responsive grids", url: "https://jackfshields.github.io/gridtools", color: "#1abc9c" },
  { title: "UX Microinteractions", subtitle: "Interaction experiments", url: "https://jackfshields.github.io/uxmicro", color: "#f39c12" },
  { title: "Data Viz Playground", subtitle: "Algorithmic visualizations", url: "https://jackfshields.github.io/dataviz", color: "#27ae60" },
  { title: "Portfolio Experiments", subtitle: "Design systems and transitions", url: "https://jackfshields.github.io/experiments", color: "#34495e" }
];

/* ---------- DOM refs ---------- */
const pit = document.getElementById('pit');
const grabBtn = document.getElementById('grabBtn');
const resetBtn = document.getElementById('resetBtn');
const claw = document.getElementById('claw');
const clawArm = document.getElementById('clawArm');
const clawHook = document.getElementById('clawHook');
const rail = document.getElementById('rail');
const bucket = document.getElementById('bucket');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
const modalOk = document.getElementById('modalOk');

/* ---------- State ---------- */
let capsules = []; // {el, projectIdx, x}
let targetCapsule = null; // selected by user click
let isBusy = false;
let clawX = 120; // current left position (px) of claw center relative to machine
const RAIL_LEFT = 64; // same as CSS left for rail
const RAIL_RIGHT_OFFSET = 64; // from right (matches CSS)
const RAIL_PADDING = 20;

/* ---------- Helpers ---------- */
const clamp = (v,a,b) => Math.max(a,Math.min(b,v));
const domRectCenterX = el => (el.getBoundingClientRect().left + el.getBoundingClientRect().right) / 2;

/* build favicon URL from project url (safe fallback if URL missing) */
function faviconFor(url){
  try{
    const u = new URL(url);
    const domain = u.hostname;
    // Google s2 service widely available; size 64
    return `https://www.google.com/s2/favicons?sz=64&domain=${domain}`;
  }catch(e){
    return '';
  }
}

/* ---------- Render pit capsules ---------- */
function renderPit(){
  pit.innerHTML = '';
  capsules = [];
  // create a horizontal layout of capsules centered in pit
  const step = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--capsule-gap')) || 16;
  let x = RAIL_LEFT + RAIL_PADDING;
  for(let i=0;i<projects.length;i++){
    const p = projects[i];
    const el = document.createElement('div');
    el.className = 'capsule';
    el.setAttribute('role','button');
    el.setAttribute('tabindex','0');
    el.dataset.idx = i;
    el.innerHTML = `<div class="fav"><img alt="" src="${faviconFor(p.url)}" onerror="this.style.opacity=.25;this.style.filter='grayscale(1)';"></div>
                    <div style="flex:1;min-width:0"><div style="font-size:0.82rem;font-weight:700;color:#eaf3ff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${p.title}</div></div>`;
    // append and measure
    pit.appendChild(el);
    const left = x;
    el.style.position = 'relative';
    el.style.left = `${left - RAIL_LEFT}px`;
    x += el.getBoundingClientRect().width + step;
    capsules.push({el, projectIdx:i, x:left});
    // interaction
    el.addEventListener('click', () => selectCapsule(i));
    el.addEventListener('keydown', (e) => { if(e.key==='Enter' || e.key===' ') { e.preventDefault(); selectCapsule(i); }});
  }
  // spread if too narrow
  // ensure initial visual (no capsule overlapped)
}

/* highlight target capsule */
function selectCapsule(i){
  capsules.forEach(c => c.el.classList.remove('selected'));
  const c = capsules.find(cc => cc.projectIdx === i);
  if(!c) { targetCapsule = null; return; }
  c.el.classList.add('selected');
  targetCapsule = c;
  // move claw horizontally over the target for easy action
  const containerRect = document.getElementById('machine').getBoundingClientRect();
  const targetCenter = c.el.getBoundingClientRect().left + c.el.getBoundingClientRect().width/2;
  const px = targetCenter - containerRect.left;
  moveClawTo(px);
}

/* move claw (animated) to absolute x inside machine */
function moveClawTo(x, cb){
  x = clamp(x, RAIL_LEFT + 10, document.getElementById('machine').clientWidth - RAIL_RIGHT_OFFSET - 10);
  clawX = x;
  claw.style.transition = 'left 420ms cubic-bezier(.2,.9,.2,1)';
  claw.style.left = `${x - 60}px`; // claw is 120px wide; center align
  setTimeout(()=>{ claw.style.transition=''; if(cb) cb(); }, 430);
}

/* ---------- Claw sequence: grab nearest under claw or selected capsule ---------- */
async function grabSequence(){
  if(isBusy) return;
  isBusy = true;
  grabBtn.disabled = true;

  // determine pick position: if targetCapsule set, else nearest capsule under clawX
  let pick = targetCapsule;
  if(!pick){
    // find capsule nearest to clawX
    const closest = capsules.reduce((acc,c)=> {
      const d = Math.abs(c.x - clawX);
      if(acc==null || d < acc.d) return {c, d}; return acc;
    }, null);
    pick = closest?.c || null;
  }
  // if still null (no capsules) early return
  if(!pick){
    isBusy = false;
    grabBtn.disabled = false;
    return;
  }

  // move claw directly above capsule if it's not already
  const containerRect = document.getElementById('machine').getBoundingClientRect();
  const capsuleCenter = pick.el.getBoundingClientRect().left + pick.el.getBoundingClientRect().width/2;
  const targetX = capsuleCenter - containerRect.left;
  await promiseMoveClaw(targetX);

  // descend
  await descendClaw();

  // "attach" capsule visually
  attachCapsuleToClaw(pick);

  // lift
  await ascendClaw();

  // move to chute
  const chuteRect = document.getElementById('chute').getBoundingClientRect();
  const chuteCenter = chuteRect.left + chuteRect.width/2;
  await promiseMoveClaw(chuteCenter - containerRect.left);

  // drop into bucket
  await dropIntoBucket(pick);

  // show modal with project info
  showModalForProject(pick.projectIdx);

  // remove capsule from pit (simulate consumed prize)
  pick.el.remove();
  capsules = capsules.filter(c => c !== pick);
  targetCapsule = null;

  isBusy = false;
  grabBtn.disabled = false;
}

/* small helper to await moveClawTo */
function promiseMoveClaw(px){
  return new Promise(resolve => moveClawTo(px, resolve));
}

/* descend animation */
function descendClaw(){
  return new Promise(resolve => {
    clawArm.style.transition = 'height 360ms cubic-bezier(.2,.9,.2,1)';
    clawArm.style.height = '160px';
    clawHook.style.transition = 'top 360ms cubic-bezier(.2,.9,.2,1)';
    clawHook.style.top = '148px';
    setTimeout(()=>{ resolve(); }, 380);
  });
}

/* ascend animation */
function ascendClaw(){
  return new Promise(resolve => {
    clawArm.style.transition = 'height 380ms cubic-bezier(.2,.9,.2,1)';
    clawArm.style.height = '80px';
    clawHook.style.transition = 'top 380ms cubic-bezier(.2,.9,.2,1)';
    clawHook.style.top = '74px';
    setTimeout(()=>{ resolve(); }, 400);
  });
}

/* attach capsule into claw visually */
function attachCapsuleToClaw(pick){
  // move capsule to absolute position and append to claw hook
  const el = pick.el;
  const rect = el.getBoundingClientRect();
  const machineRect = document.getElementById('machine').getBoundingClientRect();
  // convert to absolute coordinates inside machine
  const relLeft = rect.left - machineRect.left;
  const relTop = rect.top - machineRect.top;
  el.style.position = 'absolute';
  el.style.left = `${relLeft}px`;
  el.style.top = `${relTop}px`;
  el.style.zIndex = 200;
  // append to machine container so we can move it with the claw
  document.getElementById('machine').appendChild(el);
  // animate to hook center
  const hookRect = claw.getBoundingClientRect();
  const targetLeft = hookRect.left + hookRect.width/2 - machineRect.left - (rect.width/2);
  const targetTop = hookRect.top + 28 - machineRect.top - (rect.height/2);
  el.style.transition = 'left 260ms ease, top 260ms ease, transform 260ms ease';
  el.style.left = `${targetLeft}px`;
  el.style.top = `${targetTop}px`;
  // small rotation to suggest grab
  el.style.transform = 'rotate(-6deg)';
}

/* drop into bucket */
function dropIntoBucket(pick){
  return new Promise(resolve => {
    const el = pick.el;
    const bucketRect = bucket.getBoundingClientRect();
    const machineRect = document.getElementById('machine').getBoundingClientRect();
    const targetLeft = bucketRect.left + (bucketRect.width/2) - machineRect.left - (el.getBoundingClientRect().width/2);
    const targetTop = bucketRect.top + (bucketRect.height/2) - machineRect.top - (el.getBoundingClientRect().height/2);
    el.style.transition = 'left 360ms cubic-bezier(.2,.9,.2,1), top 360ms cubic-bezier(.2,.9,.2,1), transform 360ms ease';
    el.style.left = `${targetLeft}px`;
    el.style.top = `${targetTop}px`;
    el.style.transform = 'rotate(0deg) scale(0.86)';
    setTimeout(() => {
      // append a small icon into the bucket for permanence
      const img = el.querySelector('img') ? el.querySelector('img').cloneNode(true) : null;
      if(img){ img.style.width='56px'; img.style.height='56px'; img.style.borderRadius='8px'; bucket.appendChild(img); }
      resolve();
    }, 420);
  });
}

/* show modal */
function showModalForProject(idx){
  const p = projects[idx];
  modalTitle.textContent = `You got ${p.title}!`;
  modalBody.textContent = p.subtitle || p.desc || '';
  modal.classList.add('show');
  // clicking the modal OK will close it
}

/* reset machine */
function resetMachine(){
  // clear bucket images, re-render pit
  bucket.innerHTML = '';
  targetCapsule = null;
  renderPit();
}

/* ---------- Dragging the rail to position claw manually ---------- */
let railPointer = null;
let railStartX = 0;
let clawStartX = clawX;
rail.addEventListener('pointerdown', (e) => {
  if(isBusy) return;
  railPointer = e.pointerId;
  railStartX = e.clientX;
  clawStartX = clawX;
  rail.setPointerCapture?.(railPointer);
});
rail.addEventListener('pointermove', (e) => {
  if(railPointer === null || e.pointerId !== railPointer) return;
  const dx = e.clientX - railStartX;
  const newX = clawStartX + dx;
  moveClawTo(newX);
});
rail.addEventListener('pointerup', (e) => { if(e.pointerId===railPointer){ try{rail.releasePointerCapture?.(railPointer)}catch{}; railPointer=null; }});
rail.addEventListener('pointercancel', ()=>{ railPointer=null; });

/* ---------- Events ---------- */
grabBtn.addEventListener('click', () => grabSequence());
resetBtn.addEventListener('click', () => resetMachine());
modalOk.addEventListener('click', () => { modal.classList.remove('show'); });

/* keyboard shortcuts: arrows to nudge claw, space to grab */
window.addEventListener('keydown', (e) => {
  if(e.key === 'ArrowLeft') moveClawTo(clawX - 30);
  if(e.key === 'ArrowRight') moveClawTo(clawX + 30);
  if(e.key === ' ') { e.preventDefault(); grabSequence(); }
});

/* ---------- Init ---------- */
renderPit();

/* expose small debug API */
window._claw = { selectCapsule, grabSequence, resetMachine };
</script>
</body>
</html>
